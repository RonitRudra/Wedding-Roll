{% extends 'master_template.html' %}
{% block content %}
    {% if uploads_list|length > 0 %}
        <div>
            <p>Sort By: <a href="order=date">Date</a> <a href="order=likes">Likes</a>
        </div>
    
        {% for upload in uploads_list %}
            <div>
                <li>{{upload.date_posted}}<a href="/media/{{upload.photo_url}}">{{upload.description}}</a></li>
                <img src="/media/{{upload.photo_url}}" width="480" height="240" />
            </div> 
            <div>
                <p><input type="button" class="like" id="{{upload.slug}}" name="{{ upload.slug }}" value="like {{upload.total_likes}}" /></p>
            </div>
        {% endfor %}
    {% else %}
        <h1>Oops! No Photos Have Been Uploaded Yet!!</h1>
    {% endif %}

    <a href="{% url 'rolls:upload' %}" id="id_upload">Upload A Photo</a>
    <a href="{% url 'home:logout' %}" id="id_logout">Logout</a>

    {% if user.is_owner %}
    <a href="{% url 'rolls:manage' %}" id="id_manage">Manage Pending Requests ({{num_pending}})</a>
    {% endif %}
{% endblock %}

{% block scripts %}
<script>
    $('.like').click(function () {
        var id = $(this).attr("id");
            $.ajax({
                type: "POST",
                url: "{% url 'rolls:like' %}",
                data: { 'slug': $(this).attr('name'), 'csrfmiddlewaretoken': '{{ csrf_token }}' },
                dataType: "json",
                success: function (response) {
                    var elem = document.getElementById(id);
                    elem.value = 'Like ' + response.likes_count;
                    },
                    error: function(rs, e) {
                           alert(rs.responseText);
                    }
              });
        })
</script>
{% endblock %}